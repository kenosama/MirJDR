{"_id":"RORq0EoQlOMsH4eE","name":"Bug finder","type":"script","author":"9CQrAxorFRjXEqMG","img":"icons/svg/dice-target.svg","scope":"global","command":"//                                                                  \n// <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> \n//                                                                  \n//                        Macro code                        \n//                                                                  \n// <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> \n// \n// **************************************************************** \n// Macro:        BugReport     \n// Compability:  Tested with \n//               Foundry 0.8.8 - Sandbox 0.10.1             \n// ================================================================ \n// Date       Version  Author               Description             \n// ---------- -------- -------------------- -----------------------\n// 2021-11-19 1.0.0    Ramses800            Macro created\n// ****************************************************************    \nfunction macroTitle() {\n  let thismacroname=`Bug Report`; \n  return thismacroname;  \n}\n\n// -----------------------------------------------------------------------------\n//                               generic macro code\n// -----------------------------------------------------------------------------\n// This is used to convert texts into javascript/programmable acceptable definitions\nfunction slugify(text,separator) {\n  return text\n    .toString()\n    .normalize('NFD')                   // split an accented letter in the base letter and the acent\n    .replace(/[\\u0300-\\u036f]/g, '')   // remove all previously split accents\n    .toLowerCase()\n    .trim()\n    .replace(/[^a-z0-9 ]/g, '')   // remove all chars not letters, numbers and spaces (to be replaced)\n    .replace(/\\s+/g, separator);\n}\n// This is used to make sure that function styles id etc are unique in the total namespace\n// if not unique, then macros/other functinalities could be intermixed and produce unpredictable results\nfunction thisMacroName(){return `${slugify(macroTitle(),'_')}`;  } \n\n\n\n  \nfunction getSysInfo() {\n  // \n  // original Client detection script by viazenetti GmbH (Christian Ludwig)\n  // found here https://stackoverflow.com/questions/9514179/how-to-find-the-operating-system-details-using-javascript\n  let unknown = '-';\n  // screen\n  let screenSize = '';\n  if (screen.width) {\n    width = (screen.width) ? screen.width : '';\n    height = (screen.height) ? screen.height : '';\n    screenSize += '' + width + \" x \" + height;\n  }\n  // browser\n  let nVer = navigator.appVersion;\n  let nAgt = navigator.userAgent;\n  let browser = navigator.appName;\n  let version = '' + parseFloat(navigator.appVersion);\n  let majorVersion = parseInt(navigator.appVersion, 10);\n  let nameOffset, verOffset, ix;\n\n  // Opera\n  if ((verOffset = nAgt.indexOf('Opera')) != -1) {\n    browser = 'Opera';\n    version = nAgt.substring(verOffset + 6);\n    if ((verOffset = nAgt.indexOf('Version')) != -1) {\n      version = nAgt.substring(verOffset + 8);\n    }\n  }\n  // Opera Next\n  if ((verOffset = nAgt.indexOf('OPR')) != -1) {\n    browser = 'Opera';\n    version = nAgt.substring(verOffset + 4);\n  }\n  // FoundryVirtualTabletop\n  else if ((verOffset = nAgt.indexOf('FoundryVirtualTabletop')) != -1) {    \n    browser = 'Foundry Virtual Tabletop';\n    version = nAgt.substring(verOffset + browser.length - 2 + 1);\n  }\n  // Legacy Edge\n  else if ((verOffset = nAgt.indexOf('Edge')) != -1) {\n    browser = 'Microsoft Legacy Edge';\n    version = nAgt.substring(verOffset + 5);\n  }\n  // Edge (Chromium)\n  else if ((verOffset = nAgt.indexOf('Edg')) != -1) {\n    browser = 'Microsoft Edge';\n    version = nAgt.substring(verOffset + 4);\n  }\n  // MSIE\n  else if ((verOffset = nAgt.indexOf('MSIE')) != -1) {\n    browser = 'Microsoft Internet Explorer';\n    version = nAgt.substring(verOffset + 5);\n  }\n  // Chrome\n  else if ((verOffset = nAgt.indexOf('Chrome')) != -1) {\n    browser = 'Chrome';\n    version = nAgt.substring(verOffset + 7);\n  }\n  // Safari\n  else if ((verOffset = nAgt.indexOf('Safari')) != -1) {\n    browser = 'Safari';\n    version = nAgt.substring(verOffset + 7);\n    if ((verOffset = nAgt.indexOf('Version')) != -1) {\n      version = nAgt.substring(verOffset + 8);\n    }\n  }\n  // Firefox\n  else if ((verOffset = nAgt.indexOf('Firefox')) != -1) {\n    browser = 'Firefox';\n    version = nAgt.substring(verOffset + 8);\n  }\n  // MSIE 11+\n  else if (nAgt.indexOf('Trident/') != -1) {\n    browser = 'Microsoft Internet Explorer';\n    version = nAgt.substring(nAgt.indexOf('rv:') + 3);\n  }\n  // Other browsers\n  else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) < (verOffset = nAgt.lastIndexOf('/'))) {\n    browser = nAgt.substring(nameOffset, verOffset);\n    version = nAgt.substring(verOffset + 1);\n    if (browser.toLowerCase() == browser.toUpperCase()) {\n      browser = navigator.appName;\n    }\n  }\n  // trim the version string\n  if ((ix = version.indexOf(';')) != -1)\n    version = version.substring(0, ix);\n  if ((ix = version.indexOf(' ')) != -1)\n    version = version.substring(0, ix);\n  if ((ix = version.indexOf(')')) != -1)\n    version = version.substring(0, ix);\n    majorVersion = parseInt('' + version, 10);\n  if (isNaN(majorVersion)) {\n    version = '' + parseFloat(navigator.appVersion);\n    majorVersion = parseInt(navigator.appVersion, 10);\n  }\n  // mobile version\n  let mobile = /Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);\n  // cookie\n  let cookieEnabled = (navigator.cookieEnabled) ? true : false;\n\n  if (typeof navigator.cookieEnabled == 'undefined' && !cookieEnabled) {\n    document.cookie = 'testcookie';\n    cookieEnabled = (document.cookie.indexOf('testcookie') != -1) ? true : false;\n  }\n\n  // system\n  let os = unknown;\n  const clientStrings = [\n    {s: 'Windows 10', r: /(Windows 10.0|Windows NT 10.0)/},\n    {s: 'Windows 8.1', r: /(Windows 8.1|Windows NT 6.3)/},\n    {s: 'Windows 8', r: /(Windows 8|Windows NT 6.2)/},\n    {s: 'Windows 7', r: /(Windows 7|Windows NT 6.1)/},\n    {s: 'Windows Vista', r: /Windows NT 6.0/},\n    {s: 'Windows Server 2003', r: /Windows NT 5.2/},\n    {s: 'Windows XP', r: /(Windows NT 5.1|Windows XP)/},\n    {s: 'Windows 2000', r: /(Windows NT 5.0|Windows 2000)/},\n    {s: 'Windows ME', r: /(Win 9x 4.90|Windows ME)/},\n    {s: 'Windows 98', r: /(Windows 98|Win98)/},\n    {s: 'Windows 95', r: /(Windows 95|Win95|Windows_95)/},\n    {s: 'Windows NT 4.0', r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},\n    {s: 'Windows CE', r: /Windows CE/},\n    {s: 'Windows 3.11', r: /Win16/},\n    {s: 'Android', r: /Android/},\n    {s: 'Open BSD', r: /OpenBSD/},\n    {s: 'Sun OS', r: /SunOS/},\n    {s: 'Chrome OS', r: /CrOS/},\n    {s: 'Linux', r: /(Linux|X11(?!.*CrOS))/},\n    {s: 'iOS', r: /(iPhone|iPad|iPod)/},\n    {s: 'Mac OS X', r: /Mac OS X/},\n    {s: 'Mac OS', r: /(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},\n    {s: 'QNX', r: /QNX/},\n    {s: 'UNIX', r: /UNIX/},\n    {s: 'BeOS', r: /BeOS/},\n    {s: 'OS/2', r: /OS\\/2/},\n    {s: 'Search Bot', r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\\/Teoma|ia_archiver)/}\n  ];\n  for (let id in clientStrings) {\n    let cs = clientStrings[id];\n    if (cs.r.test(nAgt)) {\n      os = cs.s;\n      break;\n    }\n  }\n\n  let osVersion = unknown;\n\n  if (/Windows/.test(os)) {\n    osVersion = /Windows (.*)/.exec(os)[1];\n    os = 'Windows';\n  }\n\n  switch (os) {\n    case 'Mac OS':\n    case 'Mac OS X':\n    case 'Android':\n      osVersion = /(?:Android|Mac OS|Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh) ([\\.\\_\\d]+)/.exec(nAgt)[1];\n      break;\n\n    case 'iOS':\n      osVersion = /OS (\\d+)_(\\d+)_?(\\d+)?/.exec(nVer);\n      osVersion = osVersion[1] + '.' + osVersion[2] + '.' + (osVersion[3] | 0);\n      break;\n  }\n    \n  // ---------------------------------------------------------------------------\n  // get foundry info\n  // ---------------------------------------------------------------------------\n  let foundryversion='';\n  let gamesystemtitle='';\n  let gamesystemversion='';\n  let activemodulescount=0;\n  try {  \n    foundryversion=game.data.version;\n    gamesystemtitle=game.system.data.title; \n    gamesystemversion=game.system.data.version;    \n    let modules = Array.from(game.modules, ([name, value]) => ({ name, value }))\n    for (let i = 0; i < modules.length; i++) {\n        if (modules[i].value.active) {\n          activemodulescount = activemodulescount + 1;  \n        }\n      }     \n  }\n  catch(err){\n    ui.notifications.error('Error when attempting to collect Foundry information, see details in console log.' );\n    console.error(err);\n  }\n  \n  // assemble data\n  let jscd = {\n    screen: screenSize,\n    browser: browser,\n    browserVersion: version,\n    browserMajorVersion: majorVersion,\n    mobile: mobile,\n    os: os,\n    osVersion: osVersion,\n    cookies: cookieEnabled,\n    useragent:nAgt,\n    \n    foundryversion:foundryversion,\n    gamesystemtitle:gamesystemtitle,\n    gamesystemversion:gamesystemversion,\n    activemodulescount:activemodulescount\n  };\n  return jscd;\n}\n\n\nlet sys_info = getSysInfo();\n\n// -----------------------------------------------------------------------------\n//                     This macros main dialog HTML content\n// ----------------------------------------------------------------------------- \nlet labelwidth=115;\nlet inputwidth=212;\nlet modulewarning='';\nif(sys_info.activemodulescount>0){\n  modulewarning=`<i title=\"Disable all modules and check if the problem persists\" class=\"${thisMacroName()}_modulewarning fas fa-exclamation-circle\"></i>`;\n}\nlet html_content = `\n  <!--macro custom styles-->\n    <style>  \n      .${thisMacroName()}_hbo:hover {cursor: pointer;box-shadow: 0 0 5px darkred;}\n      legend.${thisMacroName()}_legend {text-align:left !important;}\n      label.${thisMacroName()}_label {min-width:115px;display: inline-block; }\n      label.${thisMacroName()}_label_right_column {margin-left: 48px;}\n      label.${thisMacroName()}_label_radio {min-width:100px;display: inline-block;}\n      label.${thisMacroName()}_label_radio:hover {cursor: pointer;box-shadow: 0 0 5px darkred;}\n      input[type=\"text\"].${thisMacroName()}_text_input{width:212px;}\n      input[type=\"text\"].${thisMacroName()}_text_input_right_column{width:212px;}\n      \n      textarea.${thisMacroName()}_text_area_description{width:100%;border: 1px solid #7a7971; border-radius: 3px;}\n      input[type=\"checkbox\"].${thisMacroName()}_chk_incorrect_client{vertical-align: middle;        margin: 3px 0px 0px 125px;   }       \n      label.${thisMacroName()}_invisible{color:rgba(0, 0, 0, 0)!important;}\n      input[type=\"text\"].${thisMacroName()}_invisible{color:rgba(0, 0, 0, 0)!important;background-color:rgba(0, 0, 0, 0)!important;border-style: none;}\n      i.${thisMacroName()}_extrainfo{font-size: 16px;    margin: 0px 0px 0px 3px;    padding: 0px 0px 0px 0px;    vertical-align: middle;}\n      i.${thisMacroName()}_modulewarning{color: red;    font-size: 21px;    margin: 0px 0px 0px 3px;    padding: 0px 0px 0px 0px;    vertical-align: middle;}\n    </style>\n  <form style=\"text-align: left;\">\n  <fieldset style=\"text-align: left;display:inline;width:49%\">\n    <legend class=\"${thisMacroName()}_legend\">Foundry Information</legend> \n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_sys_info_foundry_version\">Foundry Version</label>\n    <input class=\"${thisMacroName()}_text_input\" type=\"text\" id=\"${thisMacroName()}_sys_info_foundry_version\" name=\"${thisMacroName()}_sys_info_foundry_version\" value=\"Foundry Virtual Tabletop `+ sys_info.foundryversion +`\" disabled><br>     \n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_sys_info_game_system_name\">Game System</label>\n    <input class=\"${thisMacroName()}_text_input\" type=\"text\" id=\"${thisMacroName()}_sys_info_game_system_name\" name=\"${thisMacroName()}_sys_info_game_system_name\" value=\"`+ sys_info.gamesystemtitle + ` ` + sys_info.gamesystemversion +`\" disabled><br>   \n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_sys_info_active_module_count\">Active Modules</label>\n    <input class=\"${thisMacroName()}_text_input\" style=\"width:60px;\" type=\"text\" id=\"${thisMacroName()}_sys_info_active_module_count\" name=\"${thisMacroName()}_sys_info_active_module_count\" value=\"`+sys_info.activemodulescount+`\" disabled>`+ modulewarning + `      \n  </fieldset>\n        \n  <fieldset style=\"text-align: left;display:inline;height: 110px;vertical-align: top;\">\n    <legend class=\"${thisMacroName()}_legend\">Hosting Information</legend>   \n    \n    <input class=\"${thisMacroName()}_hbo\" style=\"margin-left:0px;\" type=\"radio\" id=\"${thisMacroName()}_sys_info_self_hosted\" name=\"${thisMacroName()}_sys_info_hosting\" value=\"Self-hosted\">\n    <label class=\"${thisMacroName()}_label_radio\" for=\"${thisMacroName()}_sys_info_self_hosted\">Self-hosted</label><br>\n    \n    <input class=\"${thisMacroName()}_hbo\" style=\"margin-left:0px;\" type=\"radio\" id=\"${thisMacroName()}_sys_info_hostingservice\" name=\"${thisMacroName()}_sys_info_hosting\" value=\"Hosting Service\">    \n    <label class=\"${thisMacroName()}_label_radio\" for=\"${thisMacroName()}_sys_info_hostingservice\">Hosting Service</label>                \n    \n    \n    <input class=\"${thisMacroName()}_text_input\" style=\"margin-left: 10px;\" type=\"text\" id=\"${thisMacroName()}_sys_info_hosting_service\" name=\"${thisMacroName()}_sys_info_hosting_service\" value=\"\">\n  </fieldset>\n    \n  <fieldset style=\"text-align: left;\">\n    <legend class=\"${thisMacroName()}_legend\">Client Information</legend>\n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_sys_info_os\">Operating System</label>\n    <input class=\"${thisMacroName()}_text_input\" type=\"text\" id=\"${thisMacroName()}_sys_info_os\" name=\"${thisMacroName()}_sys_info_os\" value=\"` + sys_info.os + ` `  + sys_info.osVersion + `\" disabled >\n    \n    <label class=\"${thisMacroName()}_label ${thisMacroName()}_label_right_column\" for=\"${thisMacroName()}_sys_info_os_also\">Bug also found on</label>\n    <input style=\"width:${inputwidth}px;\" type=\"text\" id=\"${thisMacroName()}_sys_info_os_also\" name=\"${thisMacroName()}_sys_info_os_also\" value=\"\" > <br>\n    \n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_sys_info_client_name\">Desktop Client</label>\n    <input class=\"${thisMacroName()}_text_input\" type=\"text\" id=\"${thisMacroName()}_sys_info_client_name\" name=\"${thisMacroName()}_sys_info_client_name\" value=\"` + sys_info.browser + ` ` + sys_info.browserVersion + `\" disabled>\n    \n    <label class=\"${thisMacroName()}_label ${thisMacroName()}_label_right_column\" for=\"${thisMacroName()}_sys_info_client_name_also\">Bug also found on</label>\n    <input class=\"${thisMacroName()}_text_input\" type=\"text\" id=\"${thisMacroName()}_sys_info_client_name_also\" name=\"${thisMacroName()}_sys_info_client_name_also\" value=\"\">\n    \n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_sys_info_client_name_not_correct\"> Detected client is incorrect <i title=\"Some browser identify themselves as another browser, this can be on purpose or not. &#013;&#010;This client provided the following User Agent string: &#013;&#010; ${sys_info.useragent}\" class=\"${thisMacroName()}_extrainfo far fa-question-circle\"></i></label>\n    <input class=\"${thisMacroName()}_hbo ${thisMacroName()}_chk_incorrect_client\" type=\"checkbox\" id=\"${thisMacroName()}_sys_info_client_name_not_correct\" name=\"${thisMacroName()}_sys_info_client_name_not_correct\" onclick=\"${thisMacroName()}_toggle_display()\" value=\"\">\n    \n    \n    \n    <label class=\"${thisMacroName()}_label ${thisMacroName()}_label_right_column ${thisMacroName()}_invisible\" name=\"${thisMacroName()}_sys_info_client_name_corrected_label\" for=\"${thisMacroName()}_sys_info_client_name_corrected\" disabled>Actual client used</label>\n    <input class=\"${thisMacroName()}_text_input ${thisMacroName()}_invisible\" type=\"text\" id=\"${thisMacroName()}_sys_info_client_name_corrected\" name=\"${thisMacroName()}_sys_info_client_name_corrected\" value=\"\" disabled>\n    \n    \n    \n</fieldset>\n    \n  <fieldset style=\"text-align: left;\">\n    <legend class=\"${thisMacroName()}_legend\">Bug Information</legend> \n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_subject\">Subject:</label><br>\n    <input style=\"width:100%;\" type=\"text\" id=\"${thisMacroName()}_subject\" name=\"${thisMacroName()}_subject\" value=\"\"><br>\n    <label class=\"${thisMacroName()}_label\" for=\"${thisMacroName()}_description\">Description:</label><br>\n    <textarea class=\"${thisMacroName()}_text_area_description\" id=\"${thisMacroName()}_description\" name=\"${thisMacroName()}_description\" rows=\"10\" cols=\"50\"></textarea>\n  </fieldset>\n  </form>\n  \n  <br>\n  \n  <button id=\"${thisMacroName()}_btnCopy\" style=\"width:32%;cursor:pointer;\"  onclick=\"${thisMacroName()}_copyBugReport(false)\" title=\"Copy Bug Report as text to Clipboard\"><i class =\"fas fa-copy\"></i>Copy</button>\n  <button id=\"${thisMacroName()}_btnCopyForDiscord\" style=\"width:32%;cursor:pointer;\"  onclick=\"${thisMacroName()}_copyBugReport(true)\" title=\"Copy Bug Report as Discord formatted text to Clipboard\"><i class =\"fab fa-discord\"></i>Copy with Discord formatting</button>\n  \n  <button id=\"${thisMacroName()}_btnCloseThisDialog\" style=\"width:32%;cursor:pointer;\"  onclick=\"${thisMacroName()}_closethisdialog()\" title=\"Close this dialog\"><i class =\"fas fa-window-close\"></i>Close</button>\n  <!--Hidden marker element used to detect if dialog is loaded-->\n  <input type=\"hidden\" id=\"${thisMacroName()}_appId\" value=\"-1\"> \n  \n  <script>\n  function ${thisMacroName()}_toggle_display(){\n    let element=document.querySelector('input[name=\"${thisMacroName()}_sys_info_client_name_corrected\"]');\n    ;\n    element.classList.toggle(\"${thisMacroName()}_invisible\");\n    element.toggleAttribute(\"disabled\");\n    // the label\n    element=document.querySelector('label[name=\"${thisMacroName()}_sys_info_client_name_corrected_label\"]');\n    element.classList.toggle(\"${thisMacroName()}_invisible\");\n  }  \n    \n  function ${thisMacroName()}_copyBugReport(discordformatting=false){\n    let sBugReport='';\n    // validate inputs\n    let valid_input=true;\n    let hosting_answer = document.querySelector('input[name=\"${thisMacroName()}_sys_info_hosting\"]:checked');\n    \n    if(hosting_answer==null){\n      ui.notifications.warn('No hosting selected');\n      valid_input=false;\n    }\n      \n    if(valid_input){\n      let activemodulecount=document.querySelector('input[name=\"${thisMacroName()}_sys_info_active_module_count\"]').value;\n      let moduletext='';\n      if (activemodulecount==0){\n        moduletext='TRUE';\n      }\n      else{\n        moduletext='FALSE - '+ activemodulecount +' active modules';\n      }\n      let hostingtext='';\n      if(hosting_answer.value=='Self-hosted'){\n        hostingtext='Self-hosted';\n      }\n      else{\n        hostingtext='Hosting service';\n        let hosting_service=document.querySelector('input[name=\"${thisMacroName()}_sys_info_hosting_service\"]').value;\n        if(hosting_service.length>0){\n          hostingtext += ' - '+ hosting_service + ''; \n        }\n      }\n      \n      let ostext=document.querySelector('input[name=\"${thisMacroName()}_sys_info_os\"]').value;\n      let osalso=document.querySelector('input[name=\"${thisMacroName()}_sys_info_os_also\"]').value\n      if (osalso.length>0){\n        ostext += ', ' + osalso;\n      } \n    \n      let clienttext=document.querySelector('input[name=\"${thisMacroName()}_sys_info_client_name\"]').value;\n      let actualclient=document.querySelector('input[name=\"${thisMacroName()}_sys_info_client_name_corrected\"]').value;\n      let clientincorrect = document.querySelector('input[name=\"${thisMacroName()}_sys_info_client_name_not_correct\"]');\n      if(clientincorrect.checked){\n        clienttext=actualclient;\n      }\n      let clientalso=document.querySelector('input[name=\"${thisMacroName()}_sys_info_client_name_also\"]').value\n      if (clientalso.length>0){\n        clienttext += ', ' + clientalso;\n      }\n    \n      // assemble report\n      let headersuffix='';\n      let headerprefix='';\n      if (discordformatting){\n        headersuffix='\\`';\n        headerprefix='\\`';\n      }\n      sBugReport  =headerprefix + 'ALL MODULES DISABLED    :'+ headersuffix + ' ' + moduletext + '\\\\n';\n      sBugReport +=headerprefix + 'FOUNDRY VERSION         :'+ headersuffix + ' ' + document.querySelector('input[name=\"${thisMacroName()}_sys_info_foundry_version\"]').value + '\\\\n';\n      sBugReport +=headerprefix + 'GAME SYSTEM             :'+ headersuffix + ' ' + document.querySelector('input[name=\"${thisMacroName()}_sys_info_game_system_name\"]').value+ '\\\\n';\n      sBugReport +=headerprefix + 'CLIENT OPERATING SYSTEM :'+ headersuffix + ' ' + ostext + '\\\\n';      \n      sBugReport +=headerprefix + 'CLIENT BROWSER          :'+ headersuffix + ' ' + clienttext+ '\\\\n\\\\n';\n      sBugReport +=headerprefix + 'HOSTING                 :'+ headersuffix + ' ' + hostingtext+ '\\\\n';\n      sBugReport +=headerprefix + 'SUBJECT                  '+ headersuffix + ' \\\\n' + document.querySelector('input[name=\"${thisMacroName()}_subject\"]').value+ '\\\\n';\n      sBugReport +=headerprefix + 'DESCRIPTION              '+ headersuffix + ' \\\\n' + document.querySelector('textarea[name=\"${thisMacroName()}_description\"]').value+ '\\\\n';\n      navigator.clipboard.writeText(sBugReport);\n      ui.notifications.info('Bug report copied to Clipboard');\n    }\n  }  \n  </script> \n  \n  <script>\n    function ${thisMacroName()}_closethisdialog(){     \n      let appId_element=document.getElementById('${thisMacroName()}_appId'); \n      if (appId_element!=null){            \n        let appId=appId_element.getAttribute('value');\n        if (appId!=null){ \n          let app=ui.windows[appId];\n          if (app!=null){                \n            app.close();             \n          }\n        }\n      }      \n    }\n  </script>\n    \n`;\n// -----------------------------------------------------------------------------\n//                          HTML dialog content completed\n// -----------------------------------------------------------------------------\n// check if this macro dialog is already loaded \nlet appId_element=document.getElementById(`${thisMacroName()}_appId`); \nif (appId_element!=null){\n  // already loaded    \n  let appId=appId_element.getAttribute('value');\n  if (appId!=null){ \n    let app=ui.windows[appId];\n    if (app!=null){    \n      // attempt to bring to the front\n      app.bringToTop(); \n      // and trigger refresh content button(if applicable)\n      let elem = document.getElementById(`${thisMacroName()}_btnRefresh`);\n      if (elem!=null){\n        if (typeof elem.onclick == \"function\") {\n          elem.onclick.apply(elem);\n        }               \n      }\n    }\n  }\n}\nelse{\n  // show it as dialog, after render update hidden id\n  let d = new Dialog({\n    title: `${macroTitle()}`,\n    content: html_content,\n    buttons: {},        \n    render: html => document.getElementById(`${thisMacroName()}_appId`).setAttribute('value', d.appId)\n  });\n  d.options.width = 768;\n  d.position.width = 768;\n  d.options.resizable=false;\n  d.options.closeOnEscape= true;\n  d.render(true);        \n}","folder":null,"sort":0,"permission":{"default":0,"9CQrAxorFRjXEqMG":3},"flags":{}}
